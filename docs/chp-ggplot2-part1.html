<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>chp-ggplot2-part1.knit</title>

<script src="site_libs/header-attrs-2.24/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="computer-setup.html">Computer Setup</a>
</li>
<li>
  <a href="NEON-data-intro.html">NEON Data</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Chapters
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="00-module-contents.html">Chapter overview</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Core lessons</li>
    <li>
      <a href="chp-computer-navigation.html">1. Computer navigation</a>
    </li>
    <li>
      <a href="chp-intro-to-R.html">2. Intro to R</a>
    </li>
    <li>
      <a href="chp-spreadsheets.html">3. Spreadsheets</a>
    </li>
    <li>
      <a href="chp-data-structures.html">4. Data structures</a>
    </li>
    <li>
      <a href="chp-functions.html">5. Functions</a>
    </li>
    <li>
      <a href="chp-ggplot2-part1.html">6. Intro to ggplot2</a>
    </li>
    <li>
      <a href="chp-program-flow.html">7. Program flow</a>
    </li>
    <li>
      <a href="chp-ggplot2-part2.html">8. More ggplot2</a>
    </li>
    <li>
      <a href="chp-tidyverse-basics.html">9. Tidy data</a>
    </li>
  </ul>
</li>
<li>
  <a href="download-student-RStudio-project.html">RStudio Workbook &amp; Exercises</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">




</div>


<!-- TO DO: 
1. Make key terms.
2. Make exercises.
3. Fix figures so that they are not so huge. Specify size in code chunk.
4. Check output for types 
-->
<div id="chapter-6.-simple-graphs-with-ggplot2"
class="section level1 tabset">
<h1 class="tabset">Chapter 6. Simple graphs with ggplot2</h1>
<div id="overview" class="section level2">
<h2>Overview</h2>
<blockquote>
<p>They say a picture is worth a thousand words; a good figure can
replace them entirely.</p>
</blockquote>
<p>Graphs aren’t just for the end results of a project; plotting data is
one of the best ways to quickly explore it and the various relationships
between variables.</p>
<p>There are three main plotting systems in R, the <a
href="http://www.statmethods.net/graphs/index.html">base plotting
system</a>, the <a
href="http://www.statmethods.net/advgraphs/trellis.html">lattice</a>
package, and the <a
href="http://www.statmethods.net/advgraphs/ggplot2.html">ggplot2</a>
package.</p>
<p>Today we’ll be learning about the ggplot2 package, because it is the
most effective for creating publication-quality graphics. It is also
built from a consistent grammar that aligns with data science
principles.</p>
<p>We will be working with surface water temperature and quality data
from NEON’s Teakettle Creek site (<span class="citation">National
Ecological Observatory Network (NEON) (2023a)</span>, <span
class="citation">National Ecological Observatory Network (NEON)
(2023b)</span>).</p>
<div id="what-we-will-learn" class="section level3">
<h3>What we will learn</h3>
<p>In this lesson learners will:</p>
<ul>
<li>use ggplot2 to generate single-panel graphics with one data layer
and one statistic layer</li>
<li>manipulate the aesthetics of a ggplot using different colors,
shapes, and lines</li>
<li>use different geometries to change the way data is displayed in a
ggplot</li>
<li>export graphs in a specific format and size</li>
</ul>
<div id="key-terms-commands" class="section level4">
<h4>Key Terms &amp; Commands</h4>
<ul>
<li>coordinate system</li>
<li>geometries (geoms)</li>
<li>aesthetics</li>
<li>map or mapping</li>
<li>axis labels</li>
<li>legend</li>
<li>mathematical expression</li>
<li>raster vs. vector images</li>
<li>image dimensions and resolution</li>
<li><code>ggplot()</code></li>
<li><code>aes()</code></li>
<li><code>geom_point()</code>, <code>geom_line()</code>,
<code>geom_bar()</code>, <code>geom_boxplot()</code>,
<code>geom_violinplot()</code></li>
<li><code>labs()</code></li>
<li><code>expression()</code></li>
<li><code>ggsave()</code></li>
</ul>
</div>
</div>
<div id="prerequisites" class="section level3">
<h3>Prerequisites</h3>
<p>Before beginning this lesson you should have completed the lesson <a
href="chp-functions.html">Vectorization and functions</a> and any
prerequisites therein.</p>
<p>Before you begin:</p>
<ol style="list-style-type: decimal">
<li>Open the R-course-NEON-workbook RStudio project.</li>
<li>Create a new R script named lesson_06_code.R in the lesson-code
folder of the student workbook.</li>
<li>Whenever you see R code like this:</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">Type</span> (or copy) this into your R script. Then run it <span class="cf">in</span> the Console.</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Whenever you see a challenge like this:</li>
</ol>
<div class="challenge">
<p>Try to solve the problem by writing R code into your script. Check
your answer by clicking:</p>
<details>
<summary>
<strong>Solution:</strong>
</summary>
<div class="solution">
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>The code that solves the challenge will appear here.</span></code></pre></div>
<p>Along with an explanation.</p>
</div>
</details>
</div>
<p><br></p>
<ol start="4" style="list-style-type: decimal">
<li>Be sure to click <strong>Save</strong> often to save your work.</li>
</ol>
</div>
</div>
<div id="lesson" class="section level2">
<h2>Lesson</h2>
<div id="grammar-of-graphics" class="section level3">
<h3>Grammar of graphics</h3>
<p>ggplot2 is built on the grammar of graphics, the idea that any plot
can be expressed from the same set of components: a
<strong>data</strong> set, a <strong>coordinate system</strong>, and a
set of <strong>geoms</strong> – the visual representation of data
points.</p>
<p>The key to understanding ggplot2 is thinking about a figure in
layers. This idea may be familiar to you if you have used image editing
programs like Photoshop, Illustrator, or Inkscape.</p>
<p>Begin by installing and loading the <code>ggplot2</code> package:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<p>The <code>ggplot2</code> package includes a few datasets that we can
use without needing to read in additional data. One of these is called
<code>msleep</code> and contains information about sleep cycles in
mammals. Let’s take a look at these data to see what is included. In the
Environment panel, click on the object named <code>msleep</code>. This
will open a new tabe in the Source panel so that you can see what these
data look like.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Print a statistical summary of the variables in msleep</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">summary</span>(msleep)</span></code></pre></div>
<pre><code>     name              genus               vore              order          
 Length:83          Length:83          Length:83          Length:83         
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
                                                                            
 conservation        sleep_total      sleep_rem      sleep_cycle    
 Length:83          Min.   : 1.90   Min.   :0.100   Min.   :0.1167  
 Class :character   1st Qu.: 7.85   1st Qu.:0.900   1st Qu.:0.1833  
 Mode  :character   Median :10.10   Median :1.500   Median :0.3333  
                    Mean   :10.43   Mean   :1.875   Mean   :0.4396  
                    3rd Qu.:13.75   3rd Qu.:2.400   3rd Qu.:0.5792  
                    Max.   :19.90   Max.   :6.600   Max.   :1.5000  
                                    NA&#39;s   :22      NA&#39;s   :51      
     awake          brainwt            bodywt        
 Min.   : 4.10   Min.   :0.00014   Min.   :   0.005  
 1st Qu.:10.25   1st Qu.:0.00290   1st Qu.:   0.174  
 Median :13.90   Median :0.01240   Median :   1.670  
 Mean   :13.57   Mean   :0.28158   Mean   : 166.136  
 3rd Qu.:16.15   3rd Qu.:0.12550   3rd Qu.:  41.750  
 Max.   :22.10   Max.   :5.71200   Max.   :6654.000  
                 NA&#39;s   :27                          </code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Print the dimensions of msleep</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">dim</span>(msleep)</span></code></pre></div>
<pre><code>[1] 83 11</code></pre>
<p>This table has 83 rows, each corresponding to a different mammal
species. It has 11 columns with variables that provide taxonomic
information (<code>genus</code>, <code>order</code>), ecological
information (<code>vore</code> gives the diet type), conservation status
(<code>conservation</code>) and then five variables measuring
physiological characteristics. If we want to learn more about these data
we could open the help file.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>?msleep</span></code></pre></div>
<p>We will demonstrate how to make graphs with the <code>ggplot()</code>
function using these data.</p>
<p>First, let’s make a scatterplot to examine the relationship between
brain mass (column <code>brainwt</code>) and body mass (column
<code>bodywt</code>).</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># Scatterplot of brain mass vs. body mass</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> msleep, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> bodywt, <span class="at">y =</span> brainwt)) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="images/rmd-06-unnamed-chunk-8-1.png" width="50%" style="display: block; margin: auto;" />
Let’s figure out how that code produced the graph above. The
<code>ggplot()</code> function lets R know that we’re creating a new
plot, and any of the arguments we give the <code>ggplot</code> function
are the <strong>global options</strong> for the plot: they apply to all
layers on the plot.</p>
<p>We’ve passed in two arguments to <code>ggplot</code>. First, we tell
<code>ggplot</code> what <strong>data</strong> we want to show on our
figure, in this example the <code>msleep</code> data. For the second
argument (<code>mapping</code>), we used the <code>aes()</code>
function, which tells <code>ggplot</code> how variables in the data
correspond to <strong>aesthetic properties</strong> of the figure, in
this case the <strong>x</strong> and <strong>y</strong> locations. Here
we told <code>ggplot</code> we want to plot the <code>bodywt</code>
column of the <code>msleep</code> data frame on the x-axis, and the
<code>brainwt</code> column on the y-axis. By providing x and y, we have
set up the <strong>coordinate system</strong> for the plot. Notice that
we didn’t need to give <code>aes()</code> the actual vector of data in
the column (e.g. <code>x = msleep$bodywt</code>), this is because
<code>ggplot</code> knows to look in the obhect we passed to the
<code>data</code> argument for that column.</p>
<p>By itself, the call to <code>ggplot()</code> isn’t enough to draw a
figure.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> msleep, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> bodywt, <span class="at">y =</span> brainwt))</span></code></pre></div>
<p><img src="images/rmd-06-unnamed-chunk-9-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>This line of code sets up the coordinate system of the graph, but it
doesn’t add any visual layers to it. We need to tell
<code>ggplot()</code> how we want to visually represent the data, which
we do by adding a new <strong>geometry</strong> layer. In our example,
we used <code>geom_point()</code>, which tells <code>ggplot()</code> we
want to visually represent the relationship between <strong>x</strong>
and <strong>y</strong> as a scatterplot of points.</p>
<div class="challenge">
<p>Modify the example above so that the figure shows how the number of
hours in rem sleep is related to the total number of hours asleep. Hint:
use <code>?msleep</code> to learn which columns contain the variables
you need.</p>
<details>
<summary>
<strong>Solution:</strong>
</summary>
<div class="solution">
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Scatterplot of REM sleep time vs total sleep time</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> msleep, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> sleep_total, <span class="at">y =</span> sleep_rem)) <span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<pre><code>Warning: Removed 22 rows containing missing values (`geom_point()`).</code></pre>
<p><img src="images/rmd-06-unnamed-chunk-10-1.png" width="50%" style="display: block; margin: auto;" />
Notice that we receive a warning about missing values. This is telling
us that 22 rows of data were not plotted because one of the variables we
supplied contained a missing value (<code>NA</code>).</p>
</div>
</details>
</div>
<p><br></p>
</div>
<div id="aesthetics" class="section level3">
<h3>Aesthetics</h3>
<p>In addition to the <code>x</code> and <code>y</code> coordinate
values, each point can take on other aesthetic properties, such as
<strong>color</strong>, <strong>shape</strong> and
<strong>size</strong>. We can modify each of these properties in two
ways; an aesthetic property can be set to be the same for all of the
points (for example make all points large red triangles), or an
aesthetic property can be <strong>mapped</strong> to a variable in the
data (for example, make the color of the point correspond to the diet of
the species).</p>
<p>First we will demonstrate how to change aesthetics for all points
using a graph of time in REM sleep versus total sleep time. To change an
aesthetic for all points, we specify use the aesthetic arguments in the
<code>geom_point()</code> function.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># Make all points large red triangles</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> msleep, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> sleep_total, <span class="at">y =</span> sleep_rem)) <span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">shape =</span> <span class="dv">17</span>)</span></code></pre></div>
<p>How did we know that <code>shape = 17</code> would produce triangles?
R has a set of numerical shape codes, which are easy to find via a quick
internet search:</p>
<p><img src="images/pch_chart.png" style="width:40.0%" /></p>
<p>Symbols 0 through 14 produce outlines; symbols 15 - 20 produce filled
shapes and symbols 21 - 25 produce shape where we can separately specify
the color of the outline and fill.</p>
<p>Now let’s instead make the color of the point correspond to the diet
of the species found in the <code>vore</code> column. To do this, we
provide an <code>aes()</code> function to the <code>mapping</code>
argument of the geometry we are plotting (<code>geom_point</code>). The
<code>aes()</code> function tells the <code>geom_point()</code> function
that the aesthetic property of <code>color</code> should be related to
the values found in the <code>vore</code> column of
<code>data</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># Make the color correspond to the diet type</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> msleep, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> sleep_total, <span class="at">y =</span> sleep_rem)) <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> vore))</span></code></pre></div>
<p><img src="images/rmd-06-unnamed-chunk-13-1.png" width="50%" style="display: block; margin: auto;" />
The <code>ggplot()</code> function automatically chooses the colors to
use and produces a lengend. In <a href="chp-ggplot2-part2.html">Complex
graphs with ggplot2</a> we will learn how to modify the colors used and
text in the legend.</p>
<div class="challenge">
<p>Create a scatterplot of hours in REM sleep versus total sleep hours
in which the size of the point is proportional to the species brain
mass. Hint: use the <code>size</code> argument.</p>
<details>
<summary>
<strong>Solution:</strong>
</summary>
<div class="solution">
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># Make the point size correspond to the brain mass</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> msleep, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> sleep_total, <span class="at">y =</span> sleep_rem)) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">size =</span> brainwt))</span></code></pre></div>
</div>
</details>
</div>
<p><br></p>
<p>If you completed the challenge above, you should have gotten a plot
that looks like this:</p>
<p><img src="images/rmd-06-unnamed-chunk-15-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>Notice that the scale seems a bit off. There are a lot of small
points, but the legend seems to show that brain mass goes up to 5, even
though there there aren’t any large size points on the graph. This is
because brain mass ranges from 0.0014 - 5.71 kg in the
<code>msleep</code> data frame:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">range</span>(msleep<span class="sc">$</span>brainwt)</span></code></pre></div>
<pre><code>[1] NA NA</code></pre>
<p>However, the species that have this large of a brain mass are missing
data on sleep and so are not included in the plot:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># Print the data for species with brain mass over 3 kg</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="fu">subset</span>(msleep, brainwt <span class="sc">&gt;</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code># A tibble: 2 × 11
  name    genus vore  order conservation sleep_total sleep_rem sleep_cycle awake
  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
1 Asian … Elep… herbi Prob… en                   3.9        NA          NA  20.1
2 Africa… Loxo… herbi Prob… vu                   3.3        NA          NA  20.7
# ℹ 2 more variables: brainwt &lt;dbl&gt;, bodywt &lt;dbl&gt;</code></pre>
<p>If we remake the graph using a data set that omits any species with
missing sleep data, then the legend values for point size will rescale
appropriately:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="co"># Create a data subset that contains only rows where </span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="co"># `sleep_total` and `sleep_rem` are not missing.</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">subset</span>(msleep, <span class="sc">!</span><span class="fu">is.na</span>(sleep_total) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(sleep_rem))</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="co"># Replot the data</span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> sleep_total, <span class="at">y =</span> sleep_rem)) <span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">size =</span> brainwt))</span></code></pre></div>
<p><img src="images/rmd-06-unnamed-chunk-18-1.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="challenge">
<p>Create a scatterplot of brain mass versus body mass where all of the
points are squares and in which the color of the points corresponds to
the conservation status of the species. Hint: use the
<code>conservation</code> column.</p>
<p>Fix the plot so that only data with non-missing values for the x and
y variables used are shown (e.g. <code>bodywt</code>,
<code>brainwt</code> are not <code>NA</code>).</p>
<details>
<summary>
<strong>Solution:</strong>
</summary>
<div class="solution">
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co"># Subset the data to plot to remove missing values</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">subset</span>(msleep, <span class="sc">!</span><span class="fu">is.na</span>(bodywt) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(brainwt))</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="co"># A graph of brain mass vs. body mass with </span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a><span class="co"># the point shape corresponding to the taxonomic order of each species</span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> bodywt, <span class="at">y =</span> brainwt)) <span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> conservation), <span class="at">shape =</span> <span class="dv">15</span>)</span></code></pre></div>
</div>
</details>
</div>
<p><br></p>
<p>If you solved the challenge above, your graph should look like
this:</p>
<p><img src="images/rmd-06-unnamed-chunk-20-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>This graph is hard to see because the x and y variables are very
skewed, with many species of smaller mass and few species with larger
mass. Let’s graph the log_10(mass) instead of mass to make the patterns
clearer.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="co"># Subset the data to plot to remove missing values</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">subset</span>(msleep, <span class="sc">!</span><span class="fu">is.na</span>(bodywt) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(brainwt))</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="co"># A graph of brain mass vs. body mass with </span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a><span class="co"># the point shape corresponding to the taxonomic order of each species</span></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log10</span>(bodywt), <span class="at">y =</span> <span class="fu">log10</span>(brainwt))) <span class="sc">+</span></span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> conservation), <span class="at">shape =</span> <span class="dv">15</span>)</span></code></pre></div>
<p><img src="images/rmd-06-unnamed-chunk-21-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="changing-axis-labels" class="section level3">
<h3>Changing axis labels</h3>
<p>You probably noticed that by default <code>ggplot()</code> chooses
axis and legend labels that match the names of the columns supplied as
the variables. We can change this behavior with the <code>labs()</code>
function. In the code below, we add (<code>+</code>) the
<code>labs()</code> function to the plot. Then inside the
<code>labs()</code> function, we specify the name of each aesthetic
variable we want to change the label of (<code>x</code>, <code>y</code>,
and <code>color</code>) and these arguments are separated by commas.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log10</span>(bodywt), <span class="at">y =</span> <span class="fu">log10</span>(brainwt))) <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> conservation), <span class="at">shape =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;log10 body mass (kg)&quot;</span>,</span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;log10 brain mass (kg)&quot;</span>,</span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;conservation status&quot;</span>)</span></code></pre></div>
<p><img src="images/rmd-06-unnamed-chunk-22-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Notice that we put each argument in <code>labs()</code> on a separate
line. This was just to make the code easier to read. We could have
written:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;log10 body mass (kg)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;log10 brain mass (kg)&quot;</span>, <span class="at">color =</span> <span class="st">&quot;conservation status&quot;</span>)</span></code></pre></div>
<p>When building plots with <code>ggplot()</code> your code will be
easier to read (and troubleshoot) if you only put one argument per line.
For example, here’s the entire code for the same plot formatted in this
way:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat, </span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log10</span>(bodywt), </span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>                     <span class="at">y =</span> <span class="fu">log10</span>(brainwt))) <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> conservation), </span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;log10 body mass (kg)&quot;</span>,</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;log10 brain mass (kg)&quot;</span>,</span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;conservation status&quot;</span>)</span></code></pre></div>
<div id="mathematical-notation" class="section level4">
<h4>Mathematical notation</h4>
<p>We can also use <strong>mathematical expressions</strong> to label
plot axes. Instead of log10 body mass, we could have the plot display
the 10 as a subscript: log<sub>10</sub> body mass. Expressions are also
useful for specifying units that have powers (for example
m<sup>2</sup>).</p>
<p>Mathematical notation is specified by constructing mathematical
expressions using the <code>expression()</code> function. Let’s add
expressions to the <code>labs()</code> function to make the x and y axis
labels prettier. In an expression we must use a <code>~</code> symbol to
add space between characters.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat, </span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log10</span>(bodywt), </span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>                     <span class="at">y =</span> <span class="fu">log10</span>(brainwt))) <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> conservation), </span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(log[<span class="dv">10</span>]<span class="sc">~</span><span class="st">&quot;body mass (kg)&quot;</span>),</span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(log[<span class="dv">10</span>]<span class="sc">~</span><span class="st">&quot;brain mass (kg)&quot;</span>),</span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;conservation status&quot;</span>)</span></code></pre></div>
<p><img src="images/rmd-06-unnamed-chunk-25-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>If you want to learn more about using mathematical annotation in R,
run <code>demo(plotmath)</code> in the console. Press Enter when
prompted and you will see examples of mathematical expressions appear in
the Plots panel.</p>
</div>
<div id="factor-levels" class="section level4">
<h4>Factor levels</h4>
<p>The last set of labels we should fix are the labels for the levels of
conservation status. The codes in this data are from the <a
href="https://www.iucnredlist.org/">IUCN Red List of Threatened
Species</a>. As currently shown, it is hard to know what the two letter
codes mean. The <code>ggplot()</code> function is labeling the colors
using the factor levels in the <code>conservation</code> column of
<code>dat</code>. Recall from <a href="chp-data-structures.html">Data
structures and operations</a> that a factor is a categorical variable
with pre-defined levels.</p>
<p>When we pass <code>conservation</code> to the <code>color</code>
aesthetic, the function automatically converts it to a factor and the
levels are just the values present in the vector.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>conservation_fact <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat<span class="sc">$</span>conservation)</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="fu">levels</span>(conservation_fact)</span></code></pre></div>
<pre><code>[1] &quot;domesticated&quot; &quot;en&quot;           &quot;lc&quot;           &quot;nt&quot;           &quot;vu&quot;          </code></pre>
<p>If we make the <code>conservation</code> column into a factor and
define our own more informative levels, then the <code>aes()</code>
function will use our more informative level names to label the
legend.</p>
<p>We can rename the levels of a factor by supplying a list to the
<code>levels()</code> function. Each element of this list matches one of
the levels in the factor and the names of the list elements correspond
to the new factor levels we want to use. Notice that we needed to use a
backtick (```) around list element names that had spaces in them.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="co"># Convert conservation to a factor with informative level names</span></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>dat<span class="sc">$</span>conservation <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat<span class="sc">$</span>conservation)</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a><span class="fu">levels</span>(dat<span class="sc">$</span>conservation ) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">domesticated =</span> <span class="st">&quot;domesticated&quot;</span>,</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>                                  <span class="st">`</span><span class="at">least concern</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;lc&quot;</span>,</span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>                                  <span class="at">vulnerable =</span> <span class="st">&quot;vu&quot;</span>,</span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>                                  <span class="st">`</span><span class="at">near threatened</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;nt&quot;</span>,</span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>                                  <span class="at">endangered =</span> <span class="st">&quot;en&quot;</span>)</span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a><span class="co"># View the first 10 elements </span></span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a>dat<span class="sc">$</span>conservation[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code> [1] &lt;NA&gt;          least concern domesticated  domesticated  least concern
 [6] least concern domesticated  domesticated  least concern &lt;NA&gt;         
Levels: domesticated least concern vulnerable near threatened endangered</code></pre>
<p>Now when we create the graph, the new factor levels are used in the
legend.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat, </span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log10</span>(bodywt), </span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>                     <span class="at">y =</span> <span class="fu">log10</span>(brainwt))) <span class="sc">+</span></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> conservation), </span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(log[<span class="dv">10</span>]<span class="sc">~</span><span class="st">&quot;body mass (kg)&quot;</span>),</span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(log[<span class="dv">10</span>]<span class="sc">~</span><span class="st">&quot;brain mass (kg)&quot;</span>),</span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;conservation status&quot;</span>)</span></code></pre></div>
<p><img src="images/rmd-06-unnamed-chunk-28-1.png" width="70%" style="display: block; margin: auto;" />
The order in which we specified the levels determined the order in which
colors were assigned.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="fu">levels</span>(dat<span class="sc">$</span>conservation)</span></code></pre></div>
<pre><code>[1] &quot;domesticated&quot;    &quot;least concern&quot;   &quot;vulnerable&quot;      &quot;near threatened&quot;
[5] &quot;endangered&quot;     </code></pre>
</div>
</div>
<div id="geometries" class="section level3">
<h3>Geometries</h3>
<p>So far we have only made a scatterplot, but <code>ggplot2</code> can
create a variety of graphics for displaying different types of data.
Temporal data are often displayed as a line graph to show changes in a
variable over time. Let’s use the NEON surface water temperature from
Teakettle Creek to demonstrate (see (<a
href="https://data.neonscience.org/data-products/DP1.20053.001">NEON
data product DP1.20053.001</a>) for more info).</p>
<p>After loading the data below, you may want to click on
<code>watertemp</code> in the Environment panel to remind yourself what
these data look like.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="co"># Load the lubridate package for working with dates and times</span></span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a><span class="co"># Load surface water temperature data for </span></span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a>watertemp <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/NEON_water/watertemp_30min_TECR_2021-04_2021-10.csv&quot;</span>)</span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" tabindex="-1"></a><span class="co"># Convert startDateTime to a date-time class</span></span>
<span id="cb34-8"><a href="#cb34-8" tabindex="-1"></a>watertemp<span class="sc">$</span>startDateTime <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(watertemp<span class="sc">$</span>startDateTime)</span>
<span id="cb34-9"><a href="#cb34-9" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" tabindex="-1"></a><span class="co"># Subset the data to just one sensor</span></span>
<span id="cb34-11"><a href="#cb34-11" tabindex="-1"></a>watertemp_upstream <span class="ot">&lt;-</span> <span class="fu">subset</span>(watertemp, horizontalPosition <span class="sc">==</span> <span class="dv">101</span>)</span>
<span id="cb34-12"><a href="#cb34-12" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" tabindex="-1"></a><span class="co"># Graph mean temperature over time</span></span>
<span id="cb34-14"><a href="#cb34-14" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> watertemp_upstream, </span>
<span id="cb34-15"><a href="#cb34-15" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> startDateTime, </span>
<span id="cb34-16"><a href="#cb34-16" tabindex="-1"></a>                     <span class="at">y =</span> surfWaterTempMean)) <span class="sc">+</span></span>
<span id="cb34-17"><a href="#cb34-17" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="images/rmd-06-unnamed-chunk-30-1.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="challenge">
<p>Modify the code for the graph above to give more informative x and y
axis labels. The temperature is in degrees Celsius.</p>
<p>Hint: <code>expression(degree*C)</code> will give <span
class="math inline">\(^{\circ}\)</span>C.</p>
<details>
<summary>
<strong>Solution:</strong>
</summary>
<div class="solution">
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="co"># Graph mean temperature over time</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> watertemp_upstream, </span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> startDateTime, </span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a>                     <span class="at">y =</span> surfWaterTempMean)) <span class="sc">+</span></span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time&quot;</span>,</span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="st">&quot;Temperature&quot;</span><span class="sc">~</span>(degree<span class="sc">*</span>C) ))</span></code></pre></div>
<p><img src="images/rmd-06-unnamed-chunk-31-1.png" width="50%" style="display: block; margin: auto;" /></p>
</div>
</details>
</div>
<p><br></p>
<p><code>ggplot2</code> can also make bar graphs. Bar graphs are
typically used to show variation among categories. For example, suppose
we wanted to compare the mean surface water temperatures across months.
First we would need to calculate the average water temperature for each
month. Then we could use these mean values to construct a bar graph.</p>
<p>Luckily the geometries in <code>ggplot2</code> have built-in ways to
calculate these summary statistical for us.</p>
</div>
<div id="statistical-summaries" class="section level3">
<h3>Statistical summaries</h3>
<p>In order to summarize water temperature across months, we first need
to create a variable in the data frame that indicates which month the
measurement was taken.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="co"># Create a column identifying the month</span></span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>watertemp_upstream<span class="sc">$</span>month <span class="ot">&lt;-</span> <span class="fu">month</span>(watertemp_upstream<span class="sc">$</span>startDateTime)</span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a><span class="co"># How many observations were there each month?</span></span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a><span class="fu">table</span>(watertemp_upstream<span class="sc">$</span>month)</span></code></pre></div>
<pre><code>
   4    5    6    7    8    9   10 
1440 1488 1440 1488 1488 1440 1488 </code></pre>
<p>Now we want a bar graph with <code>month</code> on the x axis and
<code>surfWaterTempMean</code> on the y axis, but we want to show this
as a bar where the height of the bar is the mean value of all
measurements that occurred within a month. To do this we use the
<code>geom_bar()</code> geometry and specify that we want to use a
summary statistic (<code>stat = "summary"</code>) to calculate the
height of the bar and that the specific statistic we want to use is the
<code>mean()</code> function.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> watertemp_upstream, </span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(month), <span class="at">y =</span> surfWaterTempMean)) <span class="sc">+</span></span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;summary&quot;</span>, <span class="at">fun =</span> mean)</span></code></pre></div>
<p><img src="images/rmd-06-unnamed-chunk-33-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>A more informative graph to show similar information is a violin
plot, which shows the median value together with information about the
distribution of a variable within each category. This allows the reader
to see the central tendency along with the range and skew of the
data.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> watertemp_upstream, </span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(month), <span class="at">y =</span> surfWaterTempMean)) <span class="sc">+</span></span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a>  <span class="fu">geom_violin</span>()</span></code></pre></div>
<p><img src="images/rmd-06-unnamed-chunk-34-1.png" width="50%" style="display: block; margin: auto;" />
Notice that we use <code>x = factor(month)</code> and not
<code>x = month</code>. This is to tell <code>aes()</code> that we want
it to treat the numeric months as a category and not as a continuous
numeric variable.</p>
<p>Boxplots provide similar, but slightly less information:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> watertemp_upstream, </span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(month), <span class="at">y =</span> surfWaterTempMean)) <span class="sc">+</span></span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="images/rmd-06-unnamed-chunk-35-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>Bar plots can also be used to display the number of observations in
different categories of data. For example, what if we were interested in
the viewing the number of erroneous measurements each month? The
<code>finalQF</code> column is a quality control variable that is equal
to 1 when a value has a data quality issue.</p>
<p>Let’s make a bar plot that counts the number of
<code>finalQF == 1</code> rows in each month. To do this we will map the
fill color aesthetic to the <code>finalQF</code> variable. But, we must
tell the <code>aes()</code> function to treat <code>finalQF</code> as a
categorical factor and not as a numerica variable.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> watertemp_upstream, </span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(month))) <span class="sc">+</span></span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(finalQF)))</span></code></pre></div>
<p><img src="images/rmd-06-unnamed-chunk-36-1.png" width="50%" style="display: block; margin: auto;" />
We can see that most erroneous measurements for this upstream sensor
occured in July (month 7) and September (month 9).</p>
<div class="challenge">
<p>Modify the stacked bar graph above to have more informative axis and
legend labels.</p>
<details>
<summary>
<strong>Solution:</strong>
</summary>
<div class="solution">
<p>Here’s one way to do this:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="co"># Convert finalQF to a factor and specify the levels</span></span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a>watertemp_upstream<span class="sc">$</span>finalQF <span class="ot">&lt;-</span> <span class="fu">factor</span>(watertemp_upstream<span class="sc">$</span>finalQF)</span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a><span class="fu">levels</span>(watertemp_upstream<span class="sc">$</span>finalQF) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">Good =</span> <span class="dv">0</span>,</span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a>                                           <span class="at">Erroneous =</span> <span class="dv">1</span>)</span>
<span id="cb42-5"><a href="#cb42-5" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" tabindex="-1"></a><span class="co"># Count the number of observations in each month</span></span>
<span id="cb42-7"><a href="#cb42-7" tabindex="-1"></a><span class="co"># with good vs. erroneous data</span></span>
<span id="cb42-8"><a href="#cb42-8" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> watertemp_upstream, </span>
<span id="cb42-9"><a href="#cb42-9" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(month))) <span class="sc">+</span></span>
<span id="cb42-10"><a href="#cb42-10" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> finalQF)) <span class="sc">+</span></span>
<span id="cb42-11"><a href="#cb42-11" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Month&quot;</span>,</span>
<span id="cb42-12"><a href="#cb42-12" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Num. observations&quot;</span>,</span>
<span id="cb42-13"><a href="#cb42-13" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p><img src="images/rmd-06-unnamed-chunk-37-1.png" width="50%" style="display: block; margin: auto;" /></p>
</div>
</details>
</div>
<p><br></p>
</div>
<div id="exporting-graphs" class="section level3">
<h3>Exporting graphs</h3>
<p>We’ve learned how to make a lot of graphs in a (relatively) short
period of time. Now the most important part- how do you get a graph out
of R to use in a document or presentation?</p>
<p>There are several strategies to export graphics from R. In the Plots
panel, you can click Export and a window will open walking you through
how to save a file. However, I recommend specifying the file export in
your code itself so that you can easily go back and change the size and
format of file you want.</p>
<p>R has several graphics devices that you can use to save any kind of
plot (not just ggplots) to file. <strong>Vector formats</strong> are pdf
and svg. These image types save points and lines as actual points and
lines so that when you zoom in they do not become grainy. In contrast,
<strong>raster formats</strong> include png, jpg and tiff. These are
best used for photographs or maps because these use pixels of different
colors to represent an image. Because of this, raster images are saved
at a particular <strong>resolution</strong>, measured in pixels per unit
length (e.g. inch). Since the graphs we have made thus are are just
points and lines, a vector format is most appropriate, but we will try a
raster format for comparison as well. Let’s try a couple formats to see
the difference between them: pdf, svg and png.</p>
<p>The easiest way to save a <code>ggplot</code> is to call the function
<code>ggsave()</code> immediately after creating the graph. This
function will export the most recently created graph to a file using the
arguments specified.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="co"># Graph mean temperature over time</span></span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> watertemp_upstream, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> startDateTime, <span class="at">y =</span> surfWaterTempMean)) <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb43-4"><a href="#cb43-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time&quot;</span>,</span>
<span id="cb43-5"><a href="#cb43-5" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="st">&quot;Temperature&quot;</span><span class="sc">~</span>(degree<span class="sc">*</span>C) ))</span>
<span id="cb43-6"><a href="#cb43-6" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" tabindex="-1"></a><span class="co"># Save the plot as a pdf measuring 4 x 6 inches</span></span>
<span id="cb43-8"><a href="#cb43-8" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">&quot;TECR mean water temp.pdf&quot;</span>,</span>
<span id="cb43-9"><a href="#cb43-9" tabindex="-1"></a>       <span class="at">path =</span> <span class="st">&quot;results&quot;</span>,</span>
<span id="cb43-10"><a href="#cb43-10" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span>
<span id="cb43-11"><a href="#cb43-11" tabindex="-1"></a></span>
<span id="cb43-12"><a href="#cb43-12" tabindex="-1"></a><span class="co"># Save the plot as a svg measuring 4 x 6 inches</span></span>
<span id="cb43-13"><a href="#cb43-13" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">&quot;TECR mean water temp.svg&quot;</span>,</span>
<span id="cb43-14"><a href="#cb43-14" tabindex="-1"></a>       <span class="at">path =</span> <span class="st">&quot;results&quot;</span>,</span>
<span id="cb43-15"><a href="#cb43-15" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span>
<span id="cb43-16"><a href="#cb43-16" tabindex="-1"></a></span>
<span id="cb43-17"><a href="#cb43-17" tabindex="-1"></a><span class="co"># Save the plot as a png measuring 4 x 6 inches with 300 pixels per inch</span></span>
<span id="cb43-18"><a href="#cb43-18" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">&quot;TECR mean water temp.png&quot;</span>,</span>
<span id="cb43-19"><a href="#cb43-19" tabindex="-1"></a>       <span class="at">path =</span> <span class="st">&quot;results&quot;</span>,</span>
<span id="cb43-20"><a href="#cb43-20" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span></code></pre></div>
<p>The <code>path = "results"</code> argument tells
<code>ggsave()</code> to save the file in a folder in the current
working directory named “results”. The file extension (.pdf, .svg, .png)
tells <code>ggsave()</code> which graphics device to use. Notice that we
specified the resolution of the png file using the argument
<code>dpi = 300</code>, which stands fo “dots per inch”. 300 DPI is a
typical resolution for most printed applications.</p>
<p>Navigate there should be three new files in the results folder in the
R-course-NEON-workbook folder. Use your computers file browser to find
and open these.</p>
<div class="challenge">
<p>Export the figure above as a pdf, but double the dimensions so that
the file is 12 x 8 inches.</p>
<p>Open this new file. What do you notice about the size of the axis
labels and lines?</p>
<details>
<summary>
<strong>Solution:</strong>
</summary>
<div class="solution">
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="co"># Save the plot as a pdf measuring 12 x 8 inches</span></span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">&quot;TECR mean water temp big.pdf&quot;</span>,</span>
<span id="cb44-3"><a href="#cb44-3" tabindex="-1"></a>       <span class="at">path =</span> <span class="st">&quot;images&quot;</span>,</span>
<span id="cb44-4"><a href="#cb44-4" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">12</span>, <span class="at">height =</span> <span class="dv">8</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span></code></pre></div>
<p>Because we increased the size of the page without changing the size
of the lines, the lines appear much thinner and the text much smaller in
the file with the larger dimensions.</p>
</div>
</details>
</div>
<p><br></p>
<div class="callout-tip">
<p><strong>Treat generated output as disposable</strong></p>
<p>Anything generated by your scripts (such as figures, intermediate
data tables, etc) should be treated as disposable: it should all be able
to be regenerated from your scripts. That way, you don’t have to
manually redo any image or data processing steps if you need to update
the data later.</p>
<p>There are lots of different ways to manage this output. Having an
output folder with different sub-directories for each separate analysis
makes it easier later. Use the results folder in the
R-course-NEON-workbook folder to organize graphs generated by your
code.</p>
</div>
</div>
</div>
<div id="exercises" class="section level2">
<h2>Exercises</h2>
<p>After completing these exercises, learners will be able to use the
ggplot2 package in R to:</p>
<ol style="list-style-type: decimal">
<li>create a scatter plot</li>
<li>create a line graph</li>
<li>create a bar chart showing a statistical summary within
categories</li>
<li>create a stacked bar chart showing counts within categories</li>
<li>create a boxplot</li>
<li>map aesthetics to data values</li>
<li>write axis labels with mathematical notation</li>
<li>export graphs to a vector-format image with specific dimensions</li>
</ol>
<p>The following exercises work with data on water quality from the
Teakettle Creek NEON site. See <a
href="https://data.neonscience.org/data-products/DP1.20288.001">NEON
data product DP1.20288.001</a> for more info.</p>
<p>Before solving the exercises load these data into a data frame named
<code>wq</code> using the following code:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="co"># Load Teakettle Creek water quality data</span></span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a>wq <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/NEON_water/waterqual_inst_TECR_2021-04_2021-10.csv&quot;</span>)</span></code></pre></div>
<p>Be sure to include this line of code at the beginning of each R
script you submit so that your code will work.</p>
<p>Note that these data contain measurements from two sensors; an
upstream sensor (<code>horizontalPosition == 101</code>) and a
downstream sensor (<code>horizontalPosition == 102</code>).</p>
<p><strong>IMPORTANT:</strong> Before making any of the plots below, you
should also filter the data to remove any erroneous measurements. Each
variable has a <code>FinalQF</code> column associated with it. If this
column is <code>0</code> then the data are good and should be kept. For
example, the following will create a dataframe of measurements where the
dissolved oxygen variables are good (and omit and erroneous
measurements)</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a>use_dat <span class="ot">&lt;-</span> <span class="fu">subset</span>(wq, dissolvedOxygenFinalQF <span class="sc">==</span> <span class="dv">0</span>)</span></code></pre></div>
<p>You could then use <code>use_dat</code> as the data for the
<code>ggplot</code>.</p>
<p><strong>6.1</strong></p>
<p>Create a scatter plot showing the relationship between chlorophyll
and dissolved oxygen. Make the color of the point correspond to the
location of the sensor (upstream or downstream).</p>
<p>Your plot should have informative axis labels with units; chlorophyll
is measured in micrograms per liter and dissolved oxygen is in
milligrams per liter. The color legend should have an informative title
and display the location of the sensor as a categorical variable and not
as a continuous number.</p>
<p>NOTE: You should filter the data before plotting it to remove
erroneous measurements of chlorophyll or dissolved oxygen. The
<code>FinalQF</code> columns for these variables indicate whether data
are good; <code>dissolvedOxygenFinalQF == 0</code> corresponds to good
dissolved oxygen data and `</p>
<p><strong>6.2</strong></p>
<p>Create a scatter plot showing the change in pH over time. There
should be two lines, one fore each sensor location, and the color of the
line should correspond to the sensor location.</p>
<p>Your plot should have informative axis labels. The color legend
should have an informative title and display the location of the sensor
as a categorical variable and not as a continuous number.</p>
<p><strong>6.3</strong></p>
<p>Create a bar chart that compares the average chlorophyll content
measured at each sensor location.</p>
<p>Your plot should have informative axis labels with units; chlorophyll
is measured in micrograms per liter.</p>
<p><strong>6.4</strong></p>
<p>Fill in the blanks in the code below to produce this graph:</p>
<p><img src="images/rmd-06-unnamed-chunk-45-1.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="co"># Load Teakettle Creek water quality data</span></span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a>wq <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/NEON_water/waterqual_inst_TECR_2021-04_2021-10.csv&quot;</span>)</span>
<span id="cb47-3"><a href="#cb47-3" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" tabindex="-1"></a><span class="co"># Redefine factor levels for finalQF</span></span>
<span id="cb47-5"><a href="#cb47-5" tabindex="-1"></a>wq<span class="sc">$</span>dissolvedOxygenFinalQF <span class="ot">&lt;-</span> <span class="fu">factor</span>(wq<span class="sc">$</span>dissolvedOxygenFinalQF)</span>
<span id="cb47-6"><a href="#cb47-6" tabindex="-1"></a><span class="fu">levels</span>(wq<span class="sc">$</span>dissolvedOxygenFinalQF) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">________ =</span> <span class="dv">0</span>,</span>
<span id="cb47-7"><a href="#cb47-7" tabindex="-1"></a>                                          <span class="at">________ =</span> <span class="dv">1</span>)</span>
<span id="cb47-8"><a href="#cb47-8" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" tabindex="-1"></a><span class="co"># Compare data quality of DO between two sensors</span></span>
<span id="cb47-10"><a href="#cb47-10" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> wq,</span>
<span id="cb47-11"><a href="#cb47-11" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> _________________)) <span class="sc">+</span></span>
<span id="cb47-12"><a href="#cb47-12" tabindex="-1"></a>         <span class="fu">________</span>(<span class="fu">aes</span>(<span class="at">fill =</span> ___________________)) <span class="sc">+</span></span>
<span id="cb47-13"><a href="#cb47-13" tabindex="-1"></a>         <span class="fu">labs</span>(<span class="at">x =</span> _____________,</span>
<span id="cb47-14"><a href="#cb47-14" tabindex="-1"></a>              <span class="at">y =</span> _____________,</span>
<span id="cb47-15"><a href="#cb47-15" tabindex="-1"></a>              <span class="at">_____ =</span> <span class="st">&quot;Data quality&quot;</span>)</span></code></pre></div>
<p>This graph compares the number of good versus erroneous dissolved
oxygen measurements between the two sensor locations. No data were
omitted from <code>wq</code> prior to making this graph.</p>
<p><strong>6.5</strong></p>
<p>Create a chart that compares the distribution of dissolved oxygen
measurements across months (e.g. a boxplot or violin plot). Measurements
from the two sensors should be combined for each month.</p>
<p>Your plot should have informative axis labels with units; dissolved
oxygen is measured in milligrams per liter.</p>
<p><strong>6.6</strong></p>
<p>Update your code for exercise 1, 3, or 5 so that the units in the
axis labels are displayed using mathematical notation: <span
class="math inline">\(\mu g~ L^{-1}\)</span> or <span
class="math inline">\(mg~L^{-1}\)</span>.</p>
<p><strong>6.7</strong></p>
<p>Export one of the graphs you produced in this exercise as a pdf with
dimensions 6 x 5 inches.</p>
</div>
<div id="sources-and-resources" class="section level2">
<h2>Sources and Resources</h2>
<p>This lesson was written by Jes Coyle and adapted from <a
href="https://swcarpentry.github.io/r-novice-gapminder/"><span
class="citation">Zimmerman et al. (2019)</span></a> episode 8.</p>
<div id="additional-resources" class="section level3">
<h3>Additional Resources</h3>
<ul>
<li><a href="https://r-graphics.org/">R Graphics Cookbook</a></li>
<li><a
href="https://ggplot2.tidyverse.org/reference/index.html">Official
ggplot2 reference</a></li>
</ul>
</div>
<div id="cited-references" class="section level3">
<h3>Cited References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-NEON-surfwatertemp" class="csl-entry">
National Ecological Observatory Network (NEON). 2023a.
<span>“Temperature (PRT) in Surface Water (DP1.20053.001).”</span>
National Ecological Observatory Network (NEON). <a
href="https://doi.org/10.48443/33ZJ-CQ24">https://doi.org/10.48443/33ZJ-CQ24</a>.
</div>
<div id="ref-NEON-surfwaterquality" class="csl-entry">
———. 2023b. <span>“Water Quality (DP1.20288.001).”</span> National
Ecological Observatory Network (NEON). <a
href="https://doi.org/10.48443/MPW3-3Q06">https://doi.org/10.48443/MPW3-3Q06</a>.
</div>
<div id="ref-swc-reproducible-lesson" class="csl-entry">
Zimmerman, Naupaka, Greg Wilson, Raniere Silva, Scott Ritchie, François
Michonneau, Jeffrey Oliver, Harriet Dashnow, et al. 2019. <span>“<span
class="nocase">swcarpentry/r-novice-gapminder: Software Carpentry: R for
Reproducible Scientific Analysis, June 2019</span>.”</span> Zenodo. <a
href="https://doi.org/10.5281/zenodo.3265164">https://doi.org/10.5281/zenodo.3265164</a>.
</div>
</div>
</div>
</div>
</div>

<hr>
<p>Introduction to Computing in R with NEON</p>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
